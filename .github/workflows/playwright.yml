jobs:
  test:
    timeout-minutes: 30
    runs-on: windows-latest

    steps:
    - name: ⬇️ Checkout repository
      uses: actions/checkout@v4

    - name: 🧹 Run setup script
      shell: pwsh
      run: .\setup.ps1

    - name: 💾 Cache Playwright browsers
      uses: actions/cache@v3
      with:
        path: C:\Users\runneradmin\AppData\Local\ms-playwright
        key: playwright-browsers-${{ runner.os }}-${{ hashFiles('package-lock.json') }}
        restore-keys: |
          playwright-browsers-${{ runner.os }}-

    - name: 📥 Install Playwright browsers
      run: npx playwright install --with-deps

    - name: 🚀 Start Angular dev server and wait
      run: |
        start /B npm start
        npx wait-on http://localhost:4200

    - name: 🧪 Run Playwright tests
      shell: pwsh
      run: npx playwright test --workers=4 --headed=false
